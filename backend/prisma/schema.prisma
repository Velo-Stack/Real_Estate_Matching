generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// Enums
enum Role {
  ADMIN
  MANAGER
  BROKER
}

enum PropertyType {
  LAND
  PROJECT
  PLAN
}

enum UsageType {
  RESIDENTIAL
  COMMERCIAL
  ADMINISTRATIVE
  INDUSTRIAL
  AGRICULTURAL
}

enum LandStatus {
  RAW
  DEVELOPED
}

enum ExclusivityType {
  EXCLUSIVE
  NON_EXCLUSIVE
}

enum PriorityType {
  HIGH
  MEDIUM
  LOW
}

enum MatchStatus {
  NEW
  CONTACTED
  NEGOTIATION
  CLOSED
  REJECTED
}

enum NotificationStatus {
  UNREAD
  READ
  ARCHIVED
}

enum AuditAction {
  CREATE
  UPDATE
  DELETE
}

// Models
model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  name      String
  password  String
  role      Role     @default(BROKER)
  
  createdOffers   Offer[]
  createdRequests Request[]
  notifications   Notification[]
  auditLogs       AuditLog[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Offer {
  id            Int             @id @default(autoincrement())
  
  // Mandatory Fields
  type          PropertyType
  usage         UsageType
  landStatus    LandStatus
  city          String
  district      String
  
  areaFrom      Float
  areaTo        Float
  priceFrom     Decimal         @db.Decimal(15, 2)
  priceTo       Decimal         @db.Decimal(15, 2)
  exclusivity   ExclusivityType

  // Optional Fields
  coordinates   String?
  description   String?

  // Relations
  createdById   Int
  createdBy     User            @relation(fields: [createdById], references: [id])
  
  matches       Match[]

  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
}

model Request {
  id            Int             @id @default(autoincrement())

  // Mandatory Fields
  type          PropertyType
  usage         UsageType
  landStatus    LandStatus
  city          String
  district      String
  
  areaFrom      Float
  areaTo        Float
  budgetFrom    Decimal         @db.Decimal(15, 2)
  budgetTo      Decimal         @db.Decimal(15, 2)
  priority      PriorityType

  // Relations
  createdById   Int
  createdBy     User            @relation(fields: [createdById], references: [id])

  matches       Match[]

  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
}

model Match {
  id        Int         @id @default(autoincrement())
  
  offerId   Int
  requestId Int
  
  offer     Offer       @relation(fields: [offerId], references: [id])
  request   Request     @relation(fields: [requestId], references: [id])
  
  score     Float       // 0-100
  status    MatchStatus @default(NEW)
  
  notifications Notification[] // A match can generate notifications

  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  @@unique([offerId, requestId])
}

model Notification {
  id        Int                @id @default(autoincrement())
  
  userId    Int
  user      User               @relation(fields: [userId], references: [id])
  
  matchId   Int
  match     Match              @relation(fields: [matchId], references: [id])
  
  status    NotificationStatus @default(UNREAD)
  
  createdAt DateTime           @default(now())
}

model AuditLog {
  id          Int         @id @default(autoincrement())
  
  userId      Int
  user        User        @relation(fields: [userId], references: [id])
  
  action      AuditAction
  resource    String      // "Offer", "Request", "User", etc.
  resourceId  Int?        // ID of the affected resource
  
  oldValues   Json?       // Previous state (for UPDATE/DELETE)
  newValues   Json?       // New state (for CREATE/UPDATE)
  
  ipAddress   String?
  userAgent   String?
  
  createdAt   DateTime    @default(now())
}
